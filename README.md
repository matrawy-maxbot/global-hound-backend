# ๐ ููุฎุต ูุดุฑูุน Global Hound - ุงูุฏููู ุงูุดุงูู

## ๐ ููุฑุณ ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุดุฑูุน](#-ูุธุฑุฉ-ุนุงูุฉ-ุนูู-ุงููุดุฑูุน)
2. [ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ](#๏ธ-ุงูุชูููุงุช-ุงููุณุชุฎุฏูุฉ)
3. [ูููู ุงููุดุฑูุน](#-ูููู-ุงููุดุฑูุน)
4. [ูุธุงู ุงููุตุงุฏูุฉ](#-ูุธุงู-ุงููุตุงุฏูุฉ)
5. [ูุธุงู ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช](#-ูุธุงู-ุงูุฃุฏูุงุฑ-ูุงูุตูุงุญูุงุช)
6. [ูุธุงู ุงูุงุดุชุฑุงูุงุช ูุงููุฏููุนุงุช](#-ูุธุงู-ุงูุงุดุชุฑุงูุงุช-ูุงููุฏููุนุงุช)
7. [ูุงุฌูุงุช API](#-ูุงุฌูุงุช-api)
8. [ููุงุนุฏ ุงูุจูุงูุงุช](#๏ธ-ููุงุนุฏ-ุงูุจูุงูุงุช)
9. [ุงูุฃูุงู ูุงูุญูุงูุฉ](#-ุงูุฃูุงู-ูุงูุญูุงูุฉ)
10. [ุงูุตูุญุงุช ูุงูููููุงุช](#-ุงูุตูุญุงุช-ูุงูููููุงุช)
11. [ุชุดุบูู ุงููุดุฑูุน](#-ุชุดุบูู-ุงููุดุฑูุน)
12. [ููุฎุต ุงูุชูููุฐ](#-ููุฎุต-ุงูุชูููุฐ)

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุดุฑูุน

**Global Hound** ูู ูุดุฑูุน ูุชูุงูู ูุชููู ูู ุซูุงุซุฉ ุฃุฌุฒุงุก ุฑุฆูุณูุฉ:

| ุงูุฌุฒุก | ุงููุตู | ุงูุจูุฑุช |
|-------|-------|--------|
| **Backend** | ุฎุงุฏู Node.js/Express ููู API ุงูุฑุฆูุณู | `3003` |
| **Stripe Server** | ุฎุงุฏู ูููุตู ููุชุนุงูู ูุน Stripe | `4242` |
| **Frontend** | ุชุทุจูู Next.js ูููุงุฌูุฉ ุงูุฃูุงููุฉ | `3000` |

### ๐ ููุงุฐุง ูุตู Stripe Serverุ

ุชู ูุตู ุฎุงุฏู Stripe ุนู ุงูู Backend ุงูุฑุฆูุณู ูุนุฏุฉ ุฃุณุจุงุจ ูููุฉ:

| ุงูุณุจุจ | ุงูุชูุงุตูู |
|-------|----------|
| **๐ ุงูุฃูุงู (Security)** | ุนุฒู ููุงุชูุญ Stripe ุงูุณุฑูุฉ ูู ุฎุงุฏู ูููุตู ูููู ูู ุณุทุญ ุงููุฌูู. ุฅุฐุง ุชู ุงุฎุชุฑุงู ุงูู Backend ุงูุฑุฆูุณูุ ุชุจูู ููุงุชูุญ ุงูุฏูุน ุขููุฉ |
| **๐ฆ ุงูุนุฒู (Isolation)** | ูุตู ููุทู ุงูุฏูุน ูููุน ุฃู ุฎูู ูู ุงูู Backend ูู ุงูุชุฃุซูุฑ ุนูู ุนูููุงุช ุงูุฏูุนุ ูุงูุนูุณ ุตุญูุญ |
| **๐ ุงูุชูุณุน (Scaling)** | ูููู ุชูุณูุน ุฎุงุฏู Stripe ุจุดูู ูุณุชูู ุญุณุจ ุญุฌู ุงููุนุงููุงุช ุฏูู ุงูุญุงุฌุฉ ูุชูุณูุน ุงูู Backend ุจุงููุงูู |
| **๐ง ุงูุตูุงูุฉ** | ุชุญุฏูุซ ุฃู ุตูุงูุฉ ูุธุงู ุงูุฏูุน ูุง ูุชุทูุจ ุฅุนุงุฏุฉ ุชุดุบูู ุงูู Backend ุงูุฑุฆูุณู |
| **๐งช ุงูุงุฎุชุจุงุฑ** | ุณูููุฉ ุงุฎุชุจุงุฑ ูุธุงู ุงูุฏูุน ุจุดูู ูููุตู |

### ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ
- โ ูุธุงู ุชุณุฌูู ููุตุงุฏูุฉ (Local + Google OAuth)
- โ ูุธุงู ุฃุฏูุงุฑ ูุชุนุฏุฏ ุงููุณุชููุงุช (Owner, Admin, User, Guest)
- โ ูุธุงู ุงุดุชุฑุงูุงุช ูุฏููุนุฉ ุนุจุฑ Stripe
- โ ููุญุฉ ุชุญูู ูููุณุชุฎุฏููู ูุงููุดุฑููู
- โ ูุธุงู ุฅุฏุงุฑุฉ ุงูุณูุงุฑุงุช (ููุซุงู ููุจูุงูุงุช)
- โ ูุธุงู ุชุฎุฒูู ูุคูุช ุจุงุณุชุฎุฏุงู Redis

---

## ๐๏ธ ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ

### Backend Stack

| ุงูุชูููุฉ | ุงููุตู |
|---------|-------|
| Node.js | ุจูุฆุฉ ุงูุชุดุบูู |
| Express.js | ุฅุทุงุฑ ุนูู ุงูููุจ |
| TypeScript | ูุบุฉ ุงูุจุฑูุฌุฉ |
| PostgreSQL | ูุงุนุฏุฉ ุงูุจูุงูุงุช (Sequelize ORM) |
| Redis | ุงูุชุฎุฒูู ุงููุคูุช ูุงูุฌูุณุงุช |
| JWT | ุฅุฏุงุฑุฉ ุงูุชูููุงุช |
| Passport.js | ุงููุตุงุฏูุฉ |
| Winston | ุชุณุฌูู ุงูุฃุญุฏุงุซ |
| Joi | ุงูุชุญูู ูู ุงูุจูุงูุงุช |

### Frontend Stack

| ุงูุชูููุฉ | ุงูุฅุตุฏุงุฑ | ุงููุตู |
|---------|---------|-------|
| Next.js | 16.1.4 | ุฅุทุงุฑ ุนูู React |
| React | 19.2.3 | ููุชุจุฉ ุงููุงุฌูุฉ |
| TypeScript | ^5 | ูุบุฉ ุงูุจุฑูุฌุฉ |
| Tailwind CSS | ^4 | ุฅุทุงุฑ ุงูุชุตููู |
| @react-oauth/google | ^0.13.4 | ูุตุงุฏูุฉ Google |
| @stripe/stripe-js | ^8.6.4 | ุชูุงูู Stripe |

### Stripe Server Stack

| ุงูุชูููุฉ | ุงููุตู |
|---------|-------|
| Node.js + Express | ุฎุงุฏู ุงููุฏููุนุงุช |
| Stripe SDK | ูุนุงูุฌุฉ ุงููุฏููุนุงุช |
| Redis | ุชุฎุฒูู ูุคูุช (ุงุฎุชูุงุฑู) |

---

## ๐ ูููู ุงููุดุฑูุน

```
mvp/
โโโ backend/                      # ๐ง ุงูุฎุงุฏู ุงูุฑุฆูุณู
โ   โโโ src/
โ   โ   โโโ app.ts               # ุชุทุจูู Express
โ   โ   โโโ server.ts            # ููุทุฉ ุงูุฏุฎูู
โ   โ   โโโ config/              # ุงูุฅุนุฏุงุฏุงุช
โ   โ   โโโ middlewares/         # Middlewares
โ   โ   โโโ modules/
โ   โ   โ   โโโ api/             # RESTful API
โ   โ   โ   โโโ auth/            # ุงููุตุงุฏูุฉ
โ   โ   โ   โโโ cache/           # Redis Cache
โ   โ   โ   โโโ database/        # ููุงุนุฏ ุงูุจูุงูุงุช
โ   โ   โ   โโโ stripe/          # ุชูุงูู Stripe
โ   โ   โโโ utils/               # ุฃุฏูุงุช ูุณุงุนุฏุฉ
โ   โโโ docs/                    # ุงูุชูุซูู
โ
โโโ global-hound/                 # ๐ Frontend
โ   โโโ app/                     # ุตูุญุงุช Next.js
โ   โ   โโโ layout.tsx           # ุงูุชุฎุทูุท ุงูุฑุฆูุณู
โ   โ   โโโ page.tsx             # ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
โ   โ   โโโ login/               # ุชุณุฌูู ุงูุฏุฎูู
โ   โ   โโโ register/            # ุงูุชุณุฌูู
โ   โ   โโโ account/             # ุงูุญุณุงุจ
โ   โ   โโโ plans/               # ุงูุฎุทุท
โ   โ   โโโ payment/             # ุงูุฏูุน
โ   โ   โโโ users/               # ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
โ   โ   โโโ admins/              # ุฅุฏุงุฑุฉ ุงููุดุฑููู
โ   โ   โโโ cars/                # ุฅุฏุงุฑุฉ ุงูุณูุงุฑุงุช
โ   โโโ components/              # ุงูููููุงุช
โ   โโโ lib/                     # Context Providers
โ   โโโ docs/                    # ุงูุชูุซูู
โ
โโโ docs/                        # ๐ ุงูููุฎุต ุงูุนุงู
```

---

## ๐ ูุธุงู ุงููุตุงุฏูุฉ

### ุทุฑู ุชุณุฌูู ุงูุฏุฎูู

| ุงูุทุฑููุฉ | ุงููุตู | API Endpoint |
|---------|-------|--------------|
| Local | ุฅูููู + ูููุฉ ูุฑูุฑ | `POST /api/v1/auth/login/email` |
| Google OAuth | ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ Google | `POST /api/v1/auth/google` |
| ุงูุชุณุฌูู | ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ | `POST /api/v1/auth/register` |

### ูุธุงู ุงูุชูููุงุช (JWT)

```typescript
// ุชูููุฏ ุงูุชูููุงุช
Access Token  โ ุตูุงุญูุฉ: 1 ุณุงุนุฉ (ูุงุจูุฉ ููุชุนุฏูู)
Refresh Token โ ุตูุงุญูุฉ: 7 ุฃูุงู (ูุงุจูุฉ ููุชุนุฏูู)

// ุงูุชุญูู ูุงูุชุฌุฏูุฏ
GET  /api/v1/auth/validate      โ ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุชููู
POST /api/v1/auth/refresh-token โ ุชุฌุฏูุฏ Access Token
GET  /api/v1/auth/me            โ ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุญุงูู
POST /api/v1/auth/logout        โ ุชุณุฌูู ุงูุฎุฑูุฌ
```

### ุขููุฉ ุงูุชุฎุฒูู (Frontend)

```typescript
// ุงูุชุฎุฒูู ูู localStorage
localStorage.setItem('token', accessToken);
localStorage.setItem('refreshToken', refreshToken);

// ุนูุฏ ุงูุชูุงุก ุงูุตูุงุญูุฉ (401) โ ูุญุงููุฉ ุชุฌุฏูุฏ ุชููุงุฆู
```

---

## ๐ฅ ูุธุงู ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช

### ุงูุชุณูุณู ุงููุฑูู ููุฃุฏูุงุฑ

| ุงูุฏูุฑ | ุงููุณุชูู | ุงููุตู | ุงูุตูุงุญูุงุช |
|-------|---------|-------|-----------|
| `owner` | 1 (ุฃุนูู) | ูุงูู ุงููุธุงู | ุฌููุน ุงูุตูุงุญูุงุช ุชููุงุฆูุงู |
| `admin` | 2 | ูุดุฑู | ุตูุงุญูุงุช ูุญุฏุฏุฉ ูุงุจูุฉ ููุชุฎุตูุต |
| `user` | 3 | ูุณุชุฎุฏู ุนุงุฏู | ุตูุงุญูุงุช ุฃุณุงุณูุฉ |
| `guest` | 4 (ุฃุฏูู) | ุฒุงุฆุฑ ุบูุฑ ูุตุงุฏู | ูุฑุงุกุฉ ูุญุฏูุฏุฉ |

### ุตูุงุญูุงุช Admin ุงููุชุงุญุฉ

| ุงูุตูุงุญูุฉ | ุงููุตู |
|----------|-------|
| `view_users` | ุนุฑุถ ูุงุฆูุฉ ุงููุณุชุฎุฏููู |
| `view_cars` | ุนุฑุถ ูุงุฆูุฉ ุงูุณูุงุฑุงุช |
| `create_cars` | ุฅูุดุงุก ุณูุงุฑุงุช ุฌุฏูุฏุฉ |
| `update_cars` | ุชุนุฏูู ุจูุงูุงุช ุงูุณูุงุฑุงุช |
| `delete_cars` | ุญุฐู ุงูุณูุงุฑุงุช |

### ุงุณุชุฎุฏุงู Middleware ููุฃุฏูุงุฑ

```typescript
// Backend - ุงูุชุญูู ูู ุงูุฃุฏูุงุฑ
checkRole(['owner', 'admin'], ['view_users'])

// Frontend - ุงูุชุญูู ูู React
const { isOwner, isAdmin, hasPermission } = useAuth();
if (hasPermission('view_users')) { /* ุนุฑุถ ุงููุญุชูู */ }
```

---

## ๐ณ ูุธุงู ุงูุงุดุชุฑุงูุงุช ูุงููุฏููุนุงุช

### ูููู ุงููุธุงู

```
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
โ  Frontend   โโโโถโ   Backend   โโโโโถโ Stripe API  โ
โ  (Next.js)  โ    โ (Port 3003) โ    โ (Port 4242) โ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
       โ                                     โ
       โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
            stripe.confirmCardPayment()
```

### ุชุฏูู ุงูุงุดุชุฑุงู

1. **ุฌูุจ ุงูุฎุทุท** โ `GET /api/v1/plans/subscription-prices`
2. **ุฅูุดุงุก/ุฌูุจ ุนููู Stripe** โ `POST /api/v1/customers/get-or-create`
3. **ุฅูุดุงุก ุงุดุชุฑุงู** โ `POST /api/v1/plans/subscriptions`
4. **ุชุฃููุฏ ุงูุฏูุน** โ `stripe.confirmCardPayment(clientSecret)`
5. **ุญูุธ ูู DB** โ `POST /api/v1/subscriptions`

### ุญุงูุงุช ุงูุงุดุชุฑุงู

| ุงูุญุงูุฉ | ุงููุตู | ุงููุตูู ูุณููุญุ |
|--------|-------|--------------|
| `active` | ุงุดุชุฑุงู ูุดุท | โ ูุนู |
| `trialing` | ูุชุฑุฉ ุชุฌุฑูุจูุฉ | โ ูุนู |
| `past_due` | ูุชุฃุฎุฑ ุงูุณุฏุงุฏ | โ๏ธ ูุญุฏูุฏ |
| `canceled` | ููุบู | โ ูุง |
| `unpaid` | ุบูุฑ ูุฏููุน | โ ูุง |
| `paused` | ููููู ูุคูุชุงู | โ ูุง |
| `incomplete` | ุบูุฑ ููุชูู | โ ูุง |

### Stripe Webhooks ุงููุฏุนููุฉ

| ุงูุญุฏุซ | ุงูุฅุฌุฑุงุก |
|-------|---------|
| `customer.subscription.created` | ูุฒุงููุฉ ูุน DB ุงููุญููุฉ |
| `customer.subscription.updated` | ุชุญุฏูุซ ุงูุญุงูุฉ |
| `customer.subscription.deleted` | ุชุญุฏูุซ ุฅูู canceled |
| `invoice.payment_succeeded` | ุชุณุฌูู ูุฌุงุญ ุงูุฏูุน |
| `invoice.payment_failed` | ุชุณุฌูู ูุฅุดุนุงุฑ |

### ุจุทุงูุงุช ุงูุงุฎุชุจุงุฑ

| ุฑูู ุงูุจุทุงูุฉ | ุงููุตู |
|-------------|-------|
| `4242424242424242` | ุจุทุงูุฉ ูุงุฌุญุฉ |
| `4000002500003155` | ุชุชุทูุจ 3D Secure |
| `4000000000000002` | ุจุทุงูุฉ ูุฑููุถุฉ |

### ๐ก๏ธ ุขููุฉ ุงูุชุญูู ูู ุงูุงุดุชุฑุงู (Subscription Check)

ูุชู ูุฑุถ ุงูุชุญูู ูู ุงูุงุดุชุฑุงู ุนุจุฑ **Middleware** ูุฎุตุต:

```typescript
// subscription.middleware.ts
export const checkSubscription = (
  applyToRoles: UserRole[] = ['user'],  // ุงูุฃุฏูุงุฑ ุงูุชู ุชุญุชุงุฌ ุงุดุชุฑุงู
  allowedPlans: string[],                // ุงูุฎุทุท ุงููุณููุญุฉ
  options: { verifyFromStripe?: boolean } = { verifyFromStripe: true }
): RequestHandler => { ... }
```

#### ููู ูุนููุ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ุทูุจ ูููุณุงุฑ ุงููุญูู                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ  checkRole()    โ  โ ุงูุชุญูู ูู ุงูุฏูุฑ ุฃููุงู
                    โโโโโโโโโโฌโโโโโโโโโ
                             โ
                             โผ
              โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ     checkSubscription()      โ
              โ  โโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
              โ  โ 1. Ownerุ โ ุชุฌุงูุฒ โ    โ  โ
              โ  โ 2. ุงูุฏูุฑ ูุญุชุงุฌ ุงุดุชุฑุงูุ โ  โ
              โ  โ 3. ุงูุชุญูู ูู Stripe    โ  โ
              โ  โ 4. ุงูุชุญูู ูู DB ูุญูู   โ  โ
              โ  โโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
              โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                             โ
              โโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ
              โ                             โ
              โผ                             โผ
     โโโโโโโโโโโโโโโ              โโโโโโโโโโโโโโโโโโโ
     โ   Success   โ              โ  403 Forbidden  โ
     โ    next()   โ              โ SUBSCRIPTION_   โ
     โโโโโโโโโโโโโโโ              โ REQUIRED        โ
                                  โโโโโโโโโโโโโโโโโโโ
```

#### ุงูุชุญูู ุงููุฒุฏูุฌ (Dual Verification)

```typescript
// ูุชุญูู ูู Stripe ุฃููุงูุ ุซู ูู DB ุงููุญููุฉ
// ููุงุฐุงุ ูุฃู Admin ูุฏ ููุบู ุงุดุชุฑุงู ูุฏููุงู (Admin Override)

const [stripeSubscription] = await stripeService.getSubscription(subId);
const [localSubscription] = await SubscriptionsService.getByStripeId(subId);

// ุฅุฐุง ูุงู ููุบู ูุญููุงู โ ุฑูุถ ุญุชู ูู ูุดุท ูู Stripe
if (localSubscription?.status === 'canceled' || localSubscription?.status === 'paused') {
  return false;  // Admin Override
}
```

#### ูุซุงู ุงูุงุณุชุฎุฏุงู ูู Routes

```typescript
// ูุณุงุฑ ูุชุทูุจ ุงุดุชุฑุงู "Pro" ุฃู "Enterprise"
router.get(
  '/cars',
  checkRole(['owner', 'admin', 'user']),           // 1. ุชุญูู ูู ุงูุฏูุฑ
  checkSubscription(['user'], ['Pro', 'Enterprise']), // 2. ุชุญูู ูู ุงูุงุดุชุฑุงู
  carsController.getAllCars
);
```

### ๐จ Raw Body ููู Webhook (ููู ุฌุฏุงู!)

โ๏ธ **ุชูุจูู ุญุฑุฌ:** ูุฌุจ ุงุณุชุฎุฏุงู **Raw Body** (ุบูุฑ ูุนุงูุฌ) ูู Webhook endpoint ูุฃู Stripe ููููุน ุงูู request body ุงูุฎุงู.

#### ุงููุดููุฉ

```typescript
// โ ุฎุทุฃ - express.json() ูุญูู ุงูู body
app.use(express.json());  // ูุฐุง ููุณุฑ ุงูุชูููุน!

// Stripe ูุญุณุจ ุงูุชูููุน ูู:
// signature = HMAC-SHA256(raw_body, webhook_secret)
// ููู express.json() ูุญูู ุงูู body ูู object ุซู ูุนูุฏู ูู string ูุฎุชูู
```

#### ุงูุญู

```typescript
// โ ุตุญูุญ - ุงุณุชุฎุฏุงู express.raw() ููู webhook ููุท

// 1. ุชุนุฑูู webhook route ูุจู express.json()
app.post(
  '/api/webhooks',
  express.raw({ type: 'application/json' }),  // โ Raw body
  webhookHandler
);

// 2. ุซู ุชุทุจูู express.json() ููุจุงูู
app.use(express.json());
```

#### ุงูุชุญูู ูู ุงูุชูููุน

```typescript
// ูู webhook handler
const sig = req.headers['stripe-signature'] as string;
const endpointSecret = process.env.STRIPE_WEBHOOK_SECRET;

try {
  // req.body ููุง ูู Buffer (raw)
  const event = stripe.webhooks.constructEvent(
    req.body,      // โ Must be raw Buffer, not parsed JSON
    sig,
    endpointSecret
  );
  
  // ูุนุงูุฌุฉ ุงูุญุฏุซ...
} catch (err) {
  console.error('โ Webhook signature verification failed');
  return res.status(400).send(`Webhook Error: ${err.message}`);
}
```

#### ููุงุฐุง ูุฐุง ูููุ

| ุจุฏูู Raw Body | ูุน Raw Body |
|---------------|-------------|
| โ ุงูุชูููุน ูุง ูุชุทุงุจู | โ ุงูุชูููุน ุตุญูุญ |
| โ 400 Webhook Error | โ 200 Success |
| โ ุงูุฃุญุฏุงุซ ูุง ุชูุนุงูุฌ | โ ุงููุฒุงููุฉ ุชุนูู |
| โ ุซุบุฑุฉ ุฃูููุฉ ูุญุชููุฉ | โ ุญูุงูุฉ ูู ุงูุชุฒููุฑ |

---

## ๐ ูุงุฌูุงุช API

### Backend API (Port 3003)

#### ุงููุตุงุฏูุฉ (`/api/v1/auth`)

| Method | ุงููุณุงุฑ | ุงููุตู |
|--------|--------|-------|
| POST | `/register` | ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ |
| POST | `/login/email` | ุชุณุฌูู ุงูุฏุฎูู |
| POST | `/google` | ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ Google |
| POST | `/refresh-token` | ุชุฌุฏูุฏ ุงูุชููู |
| GET | `/validate` | ุงูุชุญูู ูู ุงูุชููู |
| GET | `/me` | ุจูุงูุงุช ุงููุณุชุฎุฏู |

#### ุงููุณุชุฎุฏููู (`/api/v1/users`)

| Method | ุงููุณุงุฑ | ุงูุตูุงุญูุงุช |
|--------|--------|-----------|
| GET | `/` | owner, admin (view_users) |
| GET | `/:id` | owner, admin (view_users) |
| PUT | `/:id` | owner |
| DELETE | `/:id` | owner |

#### ุงูุงุดุชุฑุงูุงุช (`/api/v1/subscriptions`)

| Method | ุงููุณุงุฑ | ุงูุตูุงุญูุงุช |
|--------|--------|-----------|
| GET | `/` | owner, admin |
| GET | `/me` | ูุตุงุฏู |
| POST | `/me/cancel` | ูุตุงุฏู |
| GET | `/user/:userId` | owner, admin |
| GET | `/statistics` | owner |

#### ุงูุฎุทุท (`/api/v1/plans`)

| Method | ุงููุณุงุฑ | ุงูุตูุงุญูุงุช |
|--------|--------|-----------|
| GET | `/config` | ุนุงู |
| GET | `/prices` | ุนุงู |
| GET | `/subscription-prices` | ุนุงู |
| POST | `/subscriptions` | ูุตุงุฏู |

#### ุงูุณูุงุฑุงุช (`/api/v1/cars`)

| Method | ุงููุณุงุฑ | ุงูุตูุงุญูุงุช |
|--------|--------|-----------|
| GET | `/` | ูุตุงุฏู + ุงุดุชุฑุงู |
| GET | `/:id` | ูุตุงุฏู + ุงุดุชุฑุงู |
| POST | `/` | owner, admin (create_cars) |
| PUT | `/:id` | owner, admin (update_cars) |
| DELETE | `/:id` | owner, admin (delete_cars) |

#### ูุดุฑูู ุงููุดุงุฑูุน (`/api/v1/project-admins`)

| Method | ุงููุณุงุฑ | ุงูุตูุงุญูุงุช |
|--------|--------|-----------|
| GET | `/` | owner |
| POST | `/` | owner |
| PUT | `/:id` | owner |
| DELETE | `/:id` | owner |

---

### Stripe Server API (Port 4242)

#### ุงูุนููุงุก (`/api/customers`)

| Method | ุงููุณุงุฑ | ุงููุตู |
|--------|--------|-------|
| POST | `/` | ุฅูุดุงุก ุนููู |
| GET | `/:id` | ุฌูุจ ุนููู |
| PUT | `/:id` | ุชุญุฏูุซ ุนููู |
| DELETE | `/:id` | ุญุฐู ุนููู |
| GET | `/:id/payment-methods` | ุทุฑู ุงูุฏูุน |

#### ุงููุฏููุนุงุช (`/api/payments`)

| Method | ุงููุณุงุฑ | ุงููุตู |
|--------|--------|-------|
| POST | `/intents` | ุฅูุดุงุก Payment Intent |
| GET | `/intents/:id` | ุฌูุจ Payment Intent |
| POST | `/intents/:id/confirm` | ุชุฃููุฏ ุงูุฏูุน |
| POST | `/intents/:id/cancel` | ุฅูุบุงุก ุงูุฏูุน |

#### ุงูุงุดุชุฑุงูุงุช (`/api/subscriptions`)

| Method | ุงููุณุงุฑ | ุงููุตู |
|--------|--------|-------|
| POST | `/` | ุฅูุดุงุก ุงุดุชุฑุงู |
| GET | `/` | ูุงุฆูุฉ ุงูุงุดุชุฑุงูุงุช |
| GET | `/:id` | ุชูุงุตูู ุงุดุชุฑุงู |
| DELETE | `/:id` | ุฅูุบุงุก ุงุดุชุฑุงู |
| POST | `/:id/pause` | ุฅููุงู ูุคูุช |
| POST | `/:id/resume` | ุงุณุชุฆูุงู |

#### ุงูุงุณุชุฑุฏุงุฏุงุช (`/api/refunds`)

| Method | ุงููุณุงุฑ | ุงููุตู |
|--------|--------|-------|
| POST | `/` | ุฅูุดุงุก ุงุณุชุฑุฏุงุฏ |
| POST | `/full` | ุงุณุชุฑุฏุงุฏ ูุงูู |
| POST | `/partial` | ุงุณุชุฑุฏุงุฏ ุฌุฒุฆู |

---

## ๐๏ธ ููุงุนุฏ ุงูุจูุงูุงุช

### PostgreSQL Models

#### User Model

```typescript
interface User {
  id: string;              // UUID
  email: string;           // ูุฑูุฏ
  password_hash?: string;  // ููุชุณุฌูู ุงููุญูู
  auth_provider: 'local' | 'google';
  google_id?: string;
  first_name?: string;
  last_name?: string;
  display_name?: string;
  avatar_url?: string;
  email_verified: boolean;
  created_at: Date;
  updated_at: Date;
}
```

#### Subscription Model

```typescript
interface Subscription {
  id: string;
  user_id: string;
  stripe_subscription_id?: string;
  stripe_customer_id?: string;
  stripe_price_id?: string;
  plan_name: string;
  status: SubscriptionStatus;
  billing_interval: 'day' | 'week' | 'month' | 'year';
  amount: number;
  currency: string;
  current_period_start: Date;
  current_period_end: Date;
  cancel_at_period_end: boolean;
}
```

#### Car Model

```typescript
interface Car {
  id: string;           // UUID
  car_make: string;     // BMW, Toyota
  car_model: string;    // 325, Camry
  car_model_year: number;
  car_vin: string;      // 17 ุญุฑูุ ูุฑูุฏ
  created_at: Date;
  updated_at: Date;
}
```

#### ProjectAdmin Model

```typescript
interface ProjectAdmin {
  id: string;
  user_id: string;
  permissions: string[];  // ูุงุฆูุฉ ุงูุตูุงุญูุงุช
  created_at: Date;
  updated_at: Date;
}
```

---

## ๐ ุงูุฃูุงู ูุงูุญูุงูุฉ

### ููุฒุงุช ุงูุฃูุงู ุงูููุทุจูุฉ

| ุงูููุฒุฉ | ุงููุตู |
|--------|-------|
| **Helmet** | ุญูุงูุฉ HTTP Headers |
| **CORS** | ุงูุชุญูู ูู Origins ุงููุณููุญ ุจูุง |
| **Rate Limiting** | ุญูุงูุฉ ูู DDoS ู Brute Force |
| **XSS Protection** | ุชูุธูู ุงููุฏุฎูุงุช ูู ุฃููุงุฏ XSS |
| **JWT Authentication** | ูุตุงุฏูุฉ ุขููุฉ ุจุงูุชูููุงุช |
| **Password Hashing** | ุชุดููุฑ bcrypt |
| **Secure Sessions** | ุฌูุณุงุช Redis ูุน HttpOnly Cookies |
| **Input Validation** | ุงูุชุญูู ุจุงุณุชุฎุฏุงู Joi |
| **Webhook Signature** | ุงูุชุญูู ูู ุชูููุน Stripe |

### Rate Limiters

| ุงูููุน | ุงูุญุฏ | ุงูุงุณุชุฎุฏุงู |
|-------|------|-----------|
| `authRateLimiter` | 5 ุทูุจุงุช / 15 ุฏูููุฉ | ุชุณุฌูู ุงูุฏุฎูู |
| `generalRateLimiter` | 100 ุทูุจ / 15 ุฏูููุฉ | ุงูุทูุจุงุช ุงูุนุงูุฉ |
| `strictRateLimiter` | 10 ุทูุจุงุช / 5 ุฏูุงุฆู | ุงูุทูุจุงุช ุงูุญุณุงุณุฉ |

### ูุชุบูุฑุงุช ุงูุจูุฆุฉ

| ุงูููู | ุงููุญุชูู |
|-------|---------|
| `Security.env` | JWT_SECRET, API_KEY, CORS |
| `Database.env` | PostgreSQL, Redis |
| `Stripe.env` | Stripe Keys & Secrets |
| `IntegratedAuthentication.env` | OAuth Credentials |

---

## ๐ ุงูุตูุญุงุช ูุงูููููุงุช

### ุตูุญุงุช Frontend

| ุงูุตูุญุฉ | ุงููุณุงุฑ | ุงููุตู | ุงููุตูู |
|--------|--------|-------|--------|
| ุงูุฑุฆูุณูุฉ | `/` | ุตูุญุฉ ุงููุจูุท | ุนุงู |
| ุชุณุฌูู ุงูุฏุฎูู | `/login` | ูููุฐุฌ ุงูุฏุฎูู | ุบูุฑ ูุตุงุฏู |
| ุงูุชุณุฌูู | `/register` | ูููุฐุฌ ุงูุชุณุฌูู | ุบูุฑ ูุตุงุฏู |
| ุงูุญุณุงุจ | `/account` | ููุญุฉ ุงูุชุญูู | ูุตุงุฏู |
| ุงูุฎุทุท | `/plans` | ุนุฑุถ ุงูุฎุทุท | ุนุงู |
| ุงูุฏูุน | `/payment` | ูููุฐุฌ ุงูุฏูุน | ูุตุงุฏู |
| ูุฌุงุญ ุงูุฏูุน | `/payment/success` | ุชุฃููุฏ ุงููุฌุงุญ | ูุตุงุฏู |
| ุงููุณุชุฎุฏููู | `/users` | ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู | owner, admin |
| ุงููุดุฑููู | `/admins` | ุฅุฏุงุฑุฉ ุงููุดุฑููู | owner |
| ุงูุณูุงุฑุงุช | `/cars` | ุฅุฏุงุฑุฉ ุงูุณูุงุฑุงุช | ูุตุงุฏู + ุงุดุชุฑุงู |

### Context Providers

```typescript
// AuthProvider - ุณูุงู ุงููุตุงุฏูุฉ
interface AuthContextType {
  user: AuthUser | null;
  token: string | null;
  isLoading: boolean;
  isAuthenticated: boolean;
  isOwner: boolean;
  isAdmin: boolean;
  hasActiveSubscription: boolean;
  hasPermission: (permission: string) => boolean;
  login: (email, password) => Promise<Result>;
  register: (data) => Promise<Result>;
  loginWithGoogle: (credential) => Promise<Result>;
  logout: () => void;
  refreshUser: () => Promise<void>;
}

// GoogleAuthProvider - ูุตุงุฏูุฉ Google
// ูุบูู ุงูุชุทุจูู ุจู GoogleOAuthProvider
```

---

## ๐ ุชุดุบูู ุงููุดุฑูุน

### ุงููุชุทูุจุงุช

- Node.js >= 18
- PostgreSQL
- Redis (ุงุฎุชูุงุฑู)
- ุญุณุงุจ Stripe (Test Mode)
- ุญุณุงุจ Google Cloud (OAuth)

### ุชุดุบูู Backend

```bash
cd backend
npm install
npm run dev    # ุชุทููุฑ
npm run build  # ุจูุงุก
npm start      # ุฅูุชุงุฌ
```

### ุชุดุบูู Frontend

```bash
cd global-hound
npm install
npm run dev    # ุชุทููุฑ ุนูู localhost:3000
npm run build  # ุจูุงุก ุงูุฅูุชุงุฌ
npm start      # ุชุดุบูู ุงูุฅูุชุงุฌ
```

### ููุงุท ุงููุตูู

| ุงูุฎุฏูุฉ | URL |
|--------|-----|
| Backend API | `http://localhost:3003/api/v1` |
| Backend Health | `http://localhost:3003/health` |
| Stripe Server | `http://localhost:4242/api` |
| Frontend | `http://localhost:3000` |

---

## โ ููุฎุต ุงูุชูููุฐ

### ุงููุชุทูุจุงุช ุงูููุชููุฉ

| ุงููุชุทูุจ | ุงูุญุงูุฉ |
|---------|--------|
| ุชุณุฌูู ุงููุณุชุฎุฏููู (Local + Google) | โ |
| ูุตุงุฏูุฉ JWT (Access + Refresh) | โ |
| ูุธุงู ุงูุฃุฏูุงุฑ (Owner > Admin > User > Guest) | โ |
| ุฎุทุท ุงุดุชุฑุงู ูุฏููุนุฉ | โ |
| ุชูุงูู Stripe Checkout | โ |
| ูุนุงูุฌุฉ Webhooks | โ |
| ุงูุชุญูู ุจุงููุตูู ุญุณุจ ุงูุงุดุชุฑุงู | โ |
| ุงูุชุญูู ูู ุชูููุน Webhook | โ |
| ููุญุฉ ุชุญูู ูุญููุฉ | โ |
| ุงูุจุญุซ ูุงูููุชุฑุฉ | โ |
| ุงูุชุฑููู (Pagination) | โ |
| ููุญุฉ ุชุญูู Admin | โ |
| ุนุฑุถ ุญุงูุฉ ุงูุงุดุชุฑุงูุงุช | โ |
| ุฅูุบุงุก/ุฅููุงู ูุฏูู (Admin Override) | โ |
| ูุชุบูุฑุงุช ุงูุจูุฆุฉ ููุฃุณุฑุงุฑ | โ |
| ุชุดููุฑ ูููุงุช ุงููุฑูุฑ | โ |
| ุงูุชุญูู ูู ุงููุฏุฎูุงุช | โ |
| ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก | โ |
| ูููู ูุดุฑูุน ููุธู | โ |

---

## ๐ ูุฎุทุท ุงูุชูุงุตู ุจูู ุงูุฃุฌุฒุงุก

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         Frontend (Next.js)                     โ
โ                         localhost:3000                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
              โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโ
              โ               โ               โ
              โผ               โผ               โผ
โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ
โ   Auth APIs     โ  โ  Data APIs      โ  โ  Stripe APIs    โ
โ  /api/v1/auth   โ  โ  /api/v1/users  โ  โ  stripe.js      โ
โ                 โ  โ  /api/v1/cars   โ  โ  (Direct)       โ
โโโโโโโโโโฌโโโโโโโโโ  โโโโโโโโโโฌโโโโโโโโโ  โโโโโโโโโโฌโโโโโโโโโ
         โ                    โ                    โ
         โผ                    โผ                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      Backend (Express.js)                       โ
โ                      localhost:3003                             โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ         โ
โ  โ  Auth    โ  โ  Users   โ  โ  Stripe  โ  โ  Cache   โ         โ
โ  โ Module   โ  โ Service  โ  โ Service  โ  โ  Redis   โ         โ
โ  โโโโโโฌโโโโโโ  โโโโโโฌโโโโโโ  โโโโโโฌโโโโโโ  โโโโโโฌโโโโโโ         โ
โโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโ
        โ                     โ                   โ
        โผ                     โผ                   โผ
โโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโ
โ PostgreSQL  โ        โStripe Serverโ       โ   Redis     โ
โ  (Supabase) โ        โ Port 4242   โ       โ   Cache     โ
โโโโโโโโโโโโโโโ        โโโโโโโโฌโโโโโโโ       โโโโโโโโโโโโโโโ
                              โ
                              โผ
                       โโโโโโโโโโโโโโโ
                       โ  Stripe.com โ
                       โ   (API)     โ
                       โโโโโโโโโโโโโโโ
```

---

## ๐ ุงูุฏุนู ูุงูุชูุงุตู

- **ุงููุคูู:** El-khodary
- **ุงูุฅุตุฏุงุฑ:** 1.0.0
- **ุงูุชุฑุฎูุต:** ISC

---

*ุขุฎุฑ ุชุญุฏูุซ: ููุงูุฑ 2026*
